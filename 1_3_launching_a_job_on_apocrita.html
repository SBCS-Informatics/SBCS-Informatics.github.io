<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Launching a Job on Apocrita | SBCS-Informatics</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./1_4_basic_unix_navigation.html" />
    
    
    <link rel="prev" href="./1_2_connecting_to_apocrita.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-edit-link/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
    

        
    <div class="book" data-level="1.3" data-basepath="." data-revision="Thu Feb 09 2017 16:41:28 GMT+0000 (UTC)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="1_0_using_unix_and_apocrita.html">
            
                
                    <a href="./1_0_using_unix_and_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Using Unix and Apocrita
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="1_1_what_is_apocrita.html">
            
                
                    <a href="./1_1_what_is_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        What is Apocrita?
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="1_2_connecting_to_apocrita.html">
            
                
                    <a href="./1_2_connecting_to_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Connecting to Apocrita
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="1.3" data-path="1_3_launching_a_job_on_apocrita.html">
            
                
                    <a href="./1_3_launching_a_job_on_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Launching a Job on Apocrita
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="1_4_basic_unix_navigation.html">
            
                
                    <a href="./1_4_basic_unix_navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Basic UNIX Navigation
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="1_5_playing_with_files.html">
            
                
                    <a href="./1_5_playing_with_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Playing With Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="1_6_copying_and_downloading_files.html">
            
                
                    <a href="./1_6_copying_and_downloading_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Copying &amp; Downloading Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="1_7_dealing_with_compressed_files.html">
            
                
                    <a href="./1_7_dealing_with_compressed_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Dealing with Compressed Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="1_8_compiling_a_piece_of_software.html">
            
                
                    <a href="./1_8_compiling_a_piece_of_software.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Available Software
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="1_9_r.html">
            
                
                    <a href="./1_9_r.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        R
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="1_10_galaxy.html">
            
                
                    <a href="./1_10_galaxy.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Galaxy
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="1_11_singularity_pilot.html">
            
                
                    <a href="./1_11_singularity_pilot.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Singularity Pilot
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="1_12_handy_shortcuts.html">
            
                
                    <a href="./1_12_handy_shortcuts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        Handy Shortcuts
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="2_0_advanced.html">
            
                
                    <a href="./2_0_advanced.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="3_0_contact.html">
            
                
                    <a href="./3_0_contact.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Contact
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >SBCS-Informatics</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <a id="edit-link" href="https://github.com/sbcs-informatics/sbcs-informatics.github.io/edit/src/1_3_launching_a_job_on_apocrita.md" class="btn fa fa-edit pull-left">&#xA0;&#xA0;Edit</a><h2 id="3-launching-a-job-on-apocrita"><a name="3-launching-a-job-on-apocrita" class="plugin-anchor" href="#3-launching-a-job-on-apocrita"><span class="fa fa-link"></span></a>3. Launching a Job on Apocrita</h2>
<p>When you log in to Apocrita you will be accessing a <strong>frontend</strong>. It is very important that you do not simply run your scripts here. These nodes are there to accommodate logins to the cluster, not workload. Instead, there is a scheduling program running on the cluster which takes instructions to your job and distributes the total load over all the worker nodes. You can also use the utility servers interactively by SSHing to them from the frontend.</p>
<h3 id="interactive-use"><a name="interactive-use" class="plugin-anchor" href="#interactive-use"><span class="fa fa-link"></span></a>Interactive use</h3>
<p>These modes will log you in directly to a machine, allowing you to test, develop and try different things out in a single session. This is useful if for example you are trying a new tool out and need to test different parameters or if you are unsure about the syntax of the program. </p>
<h4 id="using-the-queueing-system-on-apocrita"><a name="using-the-queueing-system-on-apocrita" class="plugin-anchor" href="#using-the-queueing-system-on-apocrita"><span class="fa fa-link"></span></a>Using the queueing system on Apocrita</h4>
<h5 id="-qlogin"><a name="-qlogin" class="plugin-anchor" href="#-qlogin"><span class="fa fa-link"></span></a><code>qlogin</code></h5>
<p>These commands will connect you to one of the worker nodes with the requested resources available for you to use. This will allow you to run your scripts/jobs interactively on a command line. This can be useful if you want to have more freedom in what you are doing than a script allows, but should be avoided for longer jobs as the frontends are rebooted fairly frequently which may kill your job. These commands take the arguments on how what resources you need. For more details, have a look at the <a href="https://www.hpc.qmul.ac.uk/twiki/bin/view/HPC/SubmittingJobs" target="_blank">ITS Research website</a></p>
<p>Here is an example of logging onto a machine using qlogin:</p>
<pre><code>ssh -X btw000@login.hpc.qmul.ac.uk                       #log in to Apocrita
qlogin -l h_rt=3600                                      #request a session 3600s (1h) long
qlogin -l h_rt=10:0:0,h_vmem=4G                          #request 10h and 4G memory
exit                                                     #just type exit to logout
</code></pre><p>Do keep in mind that the frontends are rebooted reasonably frequently to be able to handle all the traffic on them. For this reason, it&apos;s best to keep interactive jobs fairly short. Use the utility servers or <code>qsub</code> described below for longer runs. </p>
<h4 id="sshing-to-a-utility-server"><a name="sshing-to-a-utility-server" class="plugin-anchor" href="#sshing-to-a-utility-server"><span class="fa fa-link"></span></a>SSHing to a utility server</h4>
<h5 id="frontend5-frontend6-and-sm11"><a name="frontend5-frontend6-and-sm11" class="plugin-anchor" href="#frontend5-frontend6-and-sm11"><span class="fa fa-link"></span></a>frontend5, frontend6 and SM11</h5>
<p>Once you have logged into a frontend of Apocrita, all you need to do to log in to one of these servers is to SSH to that particular name. These machines have all been bought by different groups of academics and priority remains with these groups. This only means that you need to check carefully before you start to work here, if it is free everyone is allowed to make use of the resource. </p>
<pre><code>ssh -X frontend5
ssh -X frontend6
ssh -X sm11
</code></pre><p>These machines are all different, to find out how and why, head to the <a href="2_0_advanced.html">advanced section</a>. It is <strong>VERY</strong> important that you do not overload these servers, it is up to the user to figure out what the load on the machine is and determine if there is room for their job. Use commands such as <code>top</code>, <code>htop</code> <code>free</code> etc. to make sure.</p>
<p>If you do not know exactly what this means or how to do it properly, ask your colleagues or set out to find Adrian, the cluster guy. </p>
<h3 id="non-interactive-use"><a name="non-interactive-use" class="plugin-anchor" href="#non-interactive-use"><span class="fa fa-link"></span></a>Non-interactive use</h3>
<h4 id="submitting-a-job-script-to-the-queue"><a name="submitting-a-job-script-to-the-queue" class="plugin-anchor" href="#submitting-a-job-script-to-the-queue"><span class="fa fa-link"></span></a>Submitting a job script to the queue</h4>
<p>This is the easiest way to run your job on the Apocrita cluster. Even so, it is not as simple as running your command. Remember, don&apos;t run jobs on the frontends. This method uses a command called <code>qsub</code> which takes a script as input. Inside the script you define the resources your job needs.</p>
<p>You need to write the script with the instructions for your job, below you find the simplest version of such a script. Use this as a template and add options as needed. There are several more options you can add to the header of your script which for example allows for more cores to be used.</p>
<pre><code class="lang-bash"><span class="hljs-shebang">#!/bin/sh</span>
<span class="hljs-comment">#$ -cwd              # Set the working directory for the job to the current directory</span>
<span class="hljs-comment">#$ -V</span>
<span class="hljs-comment">#$ -l h_rt=24:0:0    # Request 24 hour runtime</span>
<span class="hljs-comment">#$ -l h_vmem=1G      # Request 1GB RAM</span>
./code                                            <span class="hljs-comment"># Your code goes here</span>
/data/home/btw000/scripts/my_fave_script.sh       <span class="hljs-comment"># It could be a separate script</span>
bwa mem -t <span class="hljs-number">10</span> -p inref.fa infa.fastq &gt; out.sam    <span class="hljs-comment"># Or it could be a program installed on apocrita</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello&quot;</span> &gt; world.txt                          <span class="hljs-comment"># Or just bash code to do whatever</span>
</code></pre>
<p>After you have written and saved the script you feed it to <code>qsub</code> as such</p>
<pre><code>qsub job_script.sh
</code></pre><p>For more details, have a look at the <a href="https://www.hpc.qmul.ac.uk/twiki/bin/view/HPC/SubmittingJobs" target="_blank">ITS research website</a>, or if you feel like you can take it, the <a href="http://gridscheduler.sourceforge.net/htmlman/htmlman1/qsub.html" target="_blank">qsub man page</a>.</p>
<h3 id="monitoring-your-job"><a name="monitoring-your-job" class="plugin-anchor" href="#monitoring-your-job"><span class="fa fa-link"></span></a>Monitoring your job</h3>
<p>Use <code>qstat</code> to show the status of all your jobs in the queue on Apocrita, and <code>qdel</code> to delete a job from the queue. </p>
<p>To monitor a job running in an interactive session or on a utility server use a program like <code>top</code>. It lists all processes currently running on the machine and allows you to sort them by various criteria like CPU or memory usage. There is an arguably better version of the same type of tool called <code>htop</code>. You will need to load it with <code>module load htop/1.0.3</code> before you can use it though. Both <code>top</code> and <code>htop</code> have an argument <code>-u</code> taking a username so that you can inspect only your own processes if you want, <code>htop -u btw000</code> will show only btw000&apos;s processes. </p>
<p><img src="img/qmul_logo.png" alt="QMUL logo"></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./1_2_connecting_to_apocrita.html" class="navigation navigation-prev " aria-label="Previous page: Connecting to Apocrita"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./1_4_basic_unix_navigation.html" class="navigation navigation-next " aria-label="Next page: Basic UNIX Navigation"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"edit-link":{"base":"https://github.com/sbcs-informatics/sbcs-informatics.github.io/edit/src","label":"Edit"},"ga":{"token":"UA-69175221-1","configuration":"auto"},"search-pro":{"cutWordLib":"nodejieba","defineWord":["小需求","基础建设"]}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-69175221-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
