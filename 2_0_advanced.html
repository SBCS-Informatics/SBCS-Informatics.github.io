<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Advanced | SBCS-Informatics</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./3_0_contact.html" />
    
    
    <link rel="prev" href="./1_11_handy_shortcuts.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-edit-link/plugin.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search-pro/search-pro.css">
        
    
    

        
    <div class="book" data-level="2" data-basepath="." data-revision="Wed Nov 25 2015 16:23:04 GMT+0000 (UTC)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="1_0_using_unix_and_apocrita.html">
            
                
                    <a href="./1_0_using_unix_and_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Using Unix and Apocrita
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="1_1_what_is_apocrita.html">
            
                
                    <a href="./1_1_what_is_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        What is Apocrita?
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="1_2_connecting_to_apocrita.html">
            
                
                    <a href="./1_2_connecting_to_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Connecting to Apocrita
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="1_3_launching_a_job_on_apocrita.html">
            
                
                    <a href="./1_3_launching_a_job_on_apocrita.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Launching a Job on Apocrita
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="1_4_basic_unix_navigation.html">
            
                
                    <a href="./1_4_basic_unix_navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Basic UNIX Navigation
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="1_5_playing_with_files.html">
            
                
                    <a href="./1_5_playing_with_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Playing With Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="1_6_copying_and_downloading_files.html">
            
                
                    <a href="./1_6_copying_and_downloading_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Copying &amp; Downloading Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="1_7_dealing_with_compressed_files.html">
            
                
                    <a href="./1_7_dealing_with_compressed_files.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Dealing with Compressed Files
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="1_8_compiling_a_piece_of_software.html">
            
                
                    <a href="./1_8_compiling_a_piece_of_software.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Compiling a Piece of Software
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="1_9_r.html">
            
                
                    <a href="./1_9_r.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        R
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="1_10_galaxy.html">
            
                
                    <a href="./1_10_galaxy.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Galaxy
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="1_11_handy_shortcuts.html">
            
                
                    <a href="./1_11_handy_shortcuts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Handy Shortcuts
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="2" data-path="2_0_advanced.html">
            
                
                    <a href="./2_0_advanced.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Advanced
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="3_0_contact.html">
            
                
                    <a href="./3_0_contact.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Contact
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >SBCS-Informatics</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <a id="edit-link" href="https://github.com/sbcs-informatics/sbcs-informatics.github.io/edit/src/2_0_advanced.md" class="btn fa fa-edit pull-left">&nbsp;&nbsp;Edit</a><h2 id="advanced">Advanced</h2>
<p>This section contains more advanced information as well as tips and tricks for users who know their way around. Make sure you know what a command found here does before running it. If you are curious about something and want to know if it can be applied to your situation or research, <a href="3_0_contact.html">contact us</a>.</p>
<h2 id="1-apocrita-specifications">1. Apocrita Specifications</h2>
<h3 id="apocrita-cluster-nodes">Apocrita cluster nodes</h3>
<h4 id="thin-nodes">Thin nodes</h4>
<ul>
<li>150 Nodes</li>
<li>Dual 6-core Intel Westmere (E5645) - 2.4GHz</li>
<li>Memory 24GB</li>
</ul>
<p>Hyperthreading is currently enabled on the Intel CPUs but each (serial) job is allocated a single real core</p>
<h4 id="fat-nodes">Fat Nodes</h4>
<ul>
<li>11 Nodes</li>
<li>Four 12-core AMD Bulldozer (6234) - 2.4GHz</li>
<li>Memory 512GB</li>
</ul>
<h4 id="interconnect">Interconnect</h4>
<p>Gigabit Ethernet</p>
<h4 id="queueing-system">Queueing system</h4>
<p>Sun Grid Engine 8.0.0e</p>
<h4 id="compilers">Compilers</h4>
<p>Intel, Solaris Studio, Open64, Portland</p>
<h4 id="parallel-libraries">Parallel libraries</h4>
<p>OpenMPI</p>
<h3 id="ssh-able-nodes">SSH-able nodes</h3>
<h4 id="sm11">SM11</h4>
<p>A &quot;set free&quot; fat node that SBCS users can ssh directly into. The GPFS is mounted and it should work like any other part of Apocrita, just that the Sun Grid Engine doesnt schedule jobs here so that it is free for users to handle themselves. Check whether or not the machine is free (top, htop) before you start something, and maybe use a <a href="http://linux.die.net/man/1/nice" target="_blank">nice value</a>. To log in, just type <code>ssh sm11</code> when logged into a frontend. You can also make an ssh shortcut in your config file, explained below. </p>
<ul>
<li>Four 12-core AMD Opteron(TM) Processor 6234 - 2.4GHz</li>
<li>Mem 512GB</li>
<li>16TB local scratch disk</li>
</ul>
<h4 id="prometheus">Prometheus</h4>
<p>Purchased with NERC money by Nichols &amp; Wurm.</p>
<p>This machine is not connected to Apocrita. It runs Ubuntu 14.04 and is administrated by SBCS users. A user has to be created for anyone who wants to use this hardware, see below for contact details.</p>
<ul>
<li>2 10-core Intel Xeon CPU E5-2680 v2s clocked at Min:1199.953Mhz Max:2538.265Mhz with hyperthreading ON </li>
<li>Kernel 3.18.9-031809-generic x86_64 </li>
<li>Mem 512GB</li>
<li>13TB local scratch disk</li>
<li>Runs Ubuntu</li>
<li>Docker installed</li>
</ul>
<p>Contact: a.larkeryd@qmul.ac.uk, y.wurm@qmul.ac.uk, r.a.nichols@qmul.ac.uk</p>
<h4 id="vm21-vm22">VM21 &amp; VM22</h4>
<p>The VMs are two nodes of the Apocrita cluster on which a KVM is running. These were set up in order to have Docker running on the cluster, however this is not yet up and running properly. Users can log in to these nodes and run their programs, however there are some caveats. Only a few core modules are available at the moment (module avail). There is also a possibility that the virtual machine is slowing the nodes down. Benchmarks are to be held to determine exact implications of this. Possible that one machine will be reinstalled without the KVM.</p>
<ul>
<li>VM21 and VM22 are running on frontend5 and frontend6 respectively</li>
<li>Four 10-core Intel Xeon E5-4640 v2  - 2.20GHz</li>
<li>Mem 516GB</li>
</ul>
<h3 id="gpu">GPU</h3>
<p>There are no GPUs on Apocrita, but there is one node attached to Taurus with two NVidia C2070 GPU cards in it.</p>
<h2 id="2-ssh-keys">2. SSH Keys</h2>
<h3 id="keys">Keys</h3>
<p>You can set up a pair of SSH keys for a more secure as well as password-less login to Apocrita. This is done by having a private key on your machine, and a matching public key on the remote server, when you try to log in these two match up and let you in without having to type the user password. The private key should never be shared with anyone as it will allow that person access to your login. This is why you should always <strong>protect your private key</strong> with a passphrase.</p>
<h4 id="key-generation">Key Generation</h4>
<ol>
<li>Open a terminal window (on Windows, use MobaXterm)</li>
<li>Enter <code>ssh-keygen</code> and hit enter</li>
<li>You will see <code>Enter file in which to save the key (/home/username/.ssh/id_rsa):</code> on the screen. Just hit enter here which will save the keys in their default location.</li>
<li>The program will now ask you for a passphrase. Please enter one (it is possible to create a key without it but don&apos;t, it&apos;s to protect from someone getting hold of your private key.)</li>
<li>There is a message telling you that the key pair has been created, the public key is now located in /home/my_username/.ssh/id_rsa.pub and the private key is /home/my_username/.ssh/id_rsa.</li>
<li>You are now ready to copy the <strong>public key</strong> to Apocrita</li>
</ol>
<h4 id="public-key-copy">Public Key Copy</h4>
<p>The process is different depending on which operating system you are using. </p>
<h5 id="windows-and-linux">Windows and Linux</h5>
<p>Here its very simple, open a terminal (or MobaXterm window) and type in <code>ssh-copy-id btw000@login.hpc.qmul.ac.uk</code> using your own username. Thats it. Now try your connection <code>ssh -X btw000@login.hpc.qmul.ac.uk</code>!</p>
<h5 id="mac">Mac</h5>
<p>One of the few times having a mac will make you suffer extra work. You will have to manually copy your <strong>public key</strong> to a file located in your home directory on Apocrita.</p>
<ol>
<li>Open a terminal and go to your home directory with <code>cd</code></li>
<li>Use <code>scp</code> to copy the public key to Apocrita with this command <code>scp .ssh/id_rsa.pub btw000@login.hpc.qmul.ac.uk:~/</code></li>
<li>Login to Apocrita <code>ssh btw977@login.hpc.qmul.ac.uk</code></li>
<li><code>cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></li>
<li>You can now log out and try the connection again to see if your keys work!</li>
</ol>
<blockquote>
<p><em>If you have <a href="http://brew.sh/" target="_blank">Homebrew</a> installed on your Mac you can use it to install <code>ssh-copy-id</code> and go from there.</em></p>
</blockquote>
<h3 id="shortcuts">Shortcuts</h3>
<p>Another convenience tip is to add shorthand names for your ssh logins. The address to the apocrita head node is quite long and arguably tedious to write. So, this being computer science, of course there is a setup that will allow you to simply type something like <code>ssh apocrita</code> on the commandline to connect.</p>
<ol>
<li><code>cd ~/.ssh</code></li>
<li>Open or create the config file <code>nano config</code></li>
<li>Add the following, you may call the Host whatever you like, here I&apos;m using &quot;apocrita&quot;:<pre><code>Host apocrita
 Hostname frontend1.apocrita.hpc.qmul.ac.uk
 IdentityFile ~/.ssh/id_rsa
 User btw000
 ServerAliveInterval 300
</code></pre></li>
<li>Save and quit the editor</li>
<li>Change permissions of the file <code>chmod 600 ~/.ssh/config</code></li>
<li>Try <code>ssh apocrita</code></li>
</ol>
<p>Another example, using apocrita (our newly created shortcut to frontend1) as a proxy to connect to SM11. This way all you need to connect to SM11 is <code>ssh sm11</code>. </p>
<pre><code>Host sm11
    Hostname sm11
    User btw000
    ProxyCommand ssh apocrita nc %h %p
</code></pre><p>You may or may not want X11 forwarding and there are other <a href="http://linux.die.net/man/5/ssh_config" target="_blank">options</a>.</p>
<h2 id="3-zsh-defaults">3. <code>zsh</code> defaults</h2>
<p>These are instructions to set up your shell with some useful <code>zsh</code> settings like better autocompletion and history etc. It also contains a small set of useful aliases.</p>
<h3 id="all-you-need-to-do">All you need to do</h3>
<h4 id="save-your-own-zshrc-file">Save your own <code>.zshrc</code> file</h4>
<p>This is the file that says what zsh should do when you log in. You have one in your home directory which you will have to remove in order for this to work. This way you can keep your previous <code>.zshrc</code> if you feel like going back.</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span>
mv .zshrc .zshrc.BAK
</code></pre>
<h4 id="run-the-small-installation">Run the small installation</h4>
<pre><code class="lang-bash"><span class="hljs-built_in">source</span> /data/SBCS-Informatics/zsh_extensions
</code></pre>
<p>You should find yourself in a helpful shell. Have fun. </p>
<h3 id="details">Details</h3>
<h4 id="-zsh-5-0-7"><code>zsh</code> 5.0.7</h4>
<p>The default version of zsh that every SBCS user has (unless explicitly changed) is version 4.3.10 which doesn&apos;t contain all the functionality used here. Because of that a check is made when logging in and if the version of <code>zsh</code> isnt 5.0.7 it is loaded. </p>
<h4 id="oh-my-zsh">Oh My Zsh</h4>
<p><a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank">Oh My Zsh</a> is a large package of settings, plugins and themes for zsh which is used as foundation for these defaults. It has a ton of options but it is kept fairly simple here, including the theme. It does allow for much more customisation which you can do for yourself.</p>
<h4 id="per-directory-history">Per directory history</h4>
<p>This plugin is enabled to give you a comman line history that is specific to the directory you are in. That way when you go back to the folder where you carried out your analysis all those months ago you can just press the up-arrow on your keyboard and it will go through what last happened in this particular directory (instead of the failed installation of that python package you were wrestling with yesterday.)</p>
<h4 id="customising-further">Customising further</h4>
<p>Perhaps you want some more fancy features than what is provided here? There are a multitude of themes that change appearance of your shell, or maybe its syntax highlighting you crave. The setup followed above inserted a sourcing of our general <code>.zshrc</code> file in your local version. That file is located in your home directory. In order to change the settings you need to replace your <code>.zshrc.</code> with the contents of the SBCS-Informatics-zshrc. That way you can change anything you like! Add plugins, try the random theme, add your own aliases or even build your own functions. You can of course write your own .zshrc and use <a href="https://github.com/sorin-ionescu/prezto" target="_blank">other</a> packages. </p>
<p>There are other shells available as well. <code>fish</code> for example, which claims to be &quot;Finally, a command line shell for the 90s&quot;. However, <code>fish</code> does have slightly different syntax than <code>bash</code> and <code>zsh</code>, the two of which are very similar. Feel free to keep looking, there are other more obscure things out there. </p>
<h2 id="4-oneliners">4. Oneliners</h2>
<ul>
<li><a href="https://github.com/stephenturner/oneliners" target="_blank">Long list of bioinformatic and non-bio oneliners</a></li>
<li>Get all sbcs users: <code>ldapsearch -x cn=sbcs | grep memberUid | sort</code>. Can email to <username>@qmul.ac.uk directly</username></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./1_11_handy_shortcuts.html" class="navigation navigation-prev " aria-label="Previous page: Handy Shortcuts"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./3_0_contact.html" class="navigation navigation-next " aria-label="Next page: Contact"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search-pro/search-pro.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"edit-link":{"base":"https://github.com/sbcs-informatics/sbcs-informatics.github.io/edit/src","label":"Edit"},"ga":{"token":"UA-69175221-1","configuration":"auto"},"search-pro":{"cutWordLib":"nodejieba","defineWord":["小需求","基础建设"]}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-69175221-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
